<?xml version="1.0"?>
<flight_control name="FCS: Scarab VTOL Auto Level">
  <property>fcs/inputThrottle_nd</property>

  <!-- Roll Auto Level -->
  <property value="0.0">fcs/refRoll_rad</property>
  <property value="1.0">fcs/AutoLevelRoll</property>
  <property>fcs/refRoll_rps</property>
  <property>fcs/errRoll_rps</property>
  <property>fcs/errRoll_rad</property>
  <property>fcs/refRoll_rps_from_angle_error</property>

  <!-- Pitch Auto Level -->
  <property value="0.0">fcs/refPitch_rad</property>
  <property value="1.0">fcs/AutoLevelPitch</property>
  <property>fcs/refPitch_rps</property>
  <property>fcs/errPitch_rps</property>
  <property>fcs/errPitch_rad</property>
  <property>fcs/refPitch_rps_from_angle_error</property>
  
  <!-- Yaw Auto Level -->
  <property value="0.0">fcs/refYaw_rad</property>
  <property value="1.0">fcs/AutoLevelYaw</property>
  <property>fcs/errYaw_rps</property>
  <property>fcs/cmdYaw_rps</property>

  <channel name="OuterLoop-Angles">
    <summer name="roll_angle_error_summer">
      <input>fcs/refRoll_rad</input>
      <input>-attitude/phi-rad</input>
      <output>fcs/errRoll_rad</output>
    </summer>
    <pid name="roll_angle_to_rate_pid">
      <input>fcs/errRoll_rad</input>
      <kp>1.2</kp>
      <output>fcs/refRoll_rps_from_angle_error</output>
    </pid>

    <summer name="pitch_angle_error_summer">
      <input>fcs/refPitch_rad</input>
      <input>-attitude/pitch-rad</input>
      <output>fcs/errPitch_rad</output>
    </summer>

    <pid name="pitch_angle_to_rate_pid">
      <input>fcs/errPitch_rad</input>
      <kp>1.2</kp>
      <output>fcs/refPitch_rps_from_angle_error</output>
    </pid>

  </channel>
  
  <channel name="InnerLoop-Rates">

    <summer name="roll_error_summer">
      <input>fcs/refRoll_rps_from_angle_error</input>
      <input>-velocities/pi-rad_sec</input>
      <output>fcs/errRoll_rps</output>
    </summer>

    <pure_gain>
      <input>fcs/errRoll_rps</input>
      <gain>fcs/AutoLevelRoll</gain>
      <output>fcs/errRoll_rps</output>
    </pure_gain>

    <pid name="roll_rate_pid">
      <input>fcs/errRoll_rps</input>
      <kp>3.0</kp>
      <ki>0.0</ki>
      <kd>0.0</kd>
      <output>fcs/cmdRoll_rps</output>
    </pid>

    <summer name="pitch_error_summer">
      <input>fcs/refPitch_rps_from_angle_error</input>
      <input>-velocities/qi-rad_sec</input>
      <output>fcs/errPitch_rps</output>
    </summer>

    <pure_gain>
      <input>fcs/errPitch_rps</input>
      <gain>fcs/AutoLevelPitch</gain>
      <output>fcs/errPitch_rps</output>
    </pure_gain>

    <pid name="pitch_rate_pid">
      <input>fcs/errPitch_rps</input>
      <kp>3.0</kp>
      <ki>0.0</ki>
      <kd>0.0</kd>
      <output>fcs/cmdPitch_rps</output>
    </pid>

    <summer name="yaw_error_summer">
      <input>fcs/refYaw_rad</input>
      <input>-velocities/r-rad_sec</input>
      <output>fcs/errYaw_rps</output>
    </summer>

    <pure_gain>
      <input>fcs/errYaw_rps</input>
      <gain>fcs/AutoLevelYaw</gain>
      <output>fcs/errYaw_rps</output>
    </pure_gain>
    
    <pid name="yaw_rate_pid">
      <input>fcs/errYaw_rps</input>
      <kp>3.0</kp>
      <ki>0.0</ki>
      <kd>0.0</kd>
      <output>fcs/cmdYaw_rps</output> 
    </pid>

  </channel>
 
  <channel name="Control_Mixer">

    <summer name="Mixer_Engine_FR">
      <input>fcs/inputThrottle_nd</input>
      <input>-fcs/cmdRoll_rps</input>  
      <output>fcs/cmd_engine_FR_nd</output>
    </summer>

    <summer name="Mixer_Engine_LR">
      <input>fcs/inputThrottle_nd</input>
      <input>fcs/cmdRoll_rps</input>  
      <output>fcs/cmd_engine_LR_nd</output>
    </summer>

    <summer name="Mixer_Pitch_Up">
      <input>fcs/cmdPitch_rps</input> 
      <output>fcs/cmd_stab_up_nd</output>
    </summer>

    <summer name="Mixer_Pitch_Down">
      <input>-fcs/cmdPitch_rps</input> 
      <output>fcs/cmd_stab_down_nd</output>
    </summer>

    <summer name="Mixer_Yaw_Right">
      <input>fcs/cmdYaw_rps</input> 
      <output>fcs/cmd_stab_yaw_right_nd</output>
    </summer>

    <summer name="Mixer_Yaw_Left">
      <input>-fcs/cmdYaw_rps</input> 
      <output>fcs/cmd_stab_yaw_left_nd</output>
    </summer>
  </channel>

</flight_control>